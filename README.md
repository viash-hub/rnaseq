# rnaseq


<!-- README.md is generated by running 'quarto render README.qmd' -->

## RNA-seq

``` mermaid
flowchart TB

  subgraph inputs[Inputs]
    input_r1[Input R1 FastQ]
    input_r2[Input R2 FastQ]
    sample_metadata[Sample metadata]
    reference_fasta[Reference fasta]
    reference_gtf[Reference GTF]
  end
  inputs:::io

  input_r1 & input_r2 & sample_metadata --> prepare_reads --> processed_r1 & processed_r2 & processed_metadata
  prepare_reads[/prepare_reads/]:::comp

  reference_fasta & reference_gtf --> prepare_reference --> processed_fasta & processed_gtf & star_index
  prepare_reference[/prepare_reference/]:::comp

  processed_r1 & processed_r2 & star_index & processed_fasta & processed_gtf --> align_and_quant --> aligned_reads_bam & quant_matrix
  align_and_quant[/align_and_quant/]:::comp

  aligned_reads_bam --> postprocess_bam --> output_aligned_reads_bam
  postprocess_bam[/postprocess_bam/]:::comp

  quant_matrix & processed_metadata --> postprocess_mtx --> output_quant_matrix
  postprocess_mtx[/postprocess_mtx/]:::comp

  processed_metadata & output_quant_matrix & output_combined_qc_data --> conversion --> output_anndata & output_sce
  conversion[/conversion/]:::comp

  subgraph outputs[Outputs]
    output_aligned_reads_bam[Aligned reads]
    output_quant_matrix[Quant matrix]
    output_combined_qc_data[QC Data]
    output_combined_qc_report[QC Report]
    output_anndata[AnnData]
    output_sce[SCE]
  end
  outputs:::io

  subgraph legend[Legend]
    comp[/Component/]:::comp
  end
  legend:::info


  classDef info stroke-dasharray: 4 4
```

## RNA-seq (With reporting)

``` mermaid
flowchart TB

  subgraph inputs[Inputs]
    input_r1[Input R1 FastQ]
    input_r2[Input R2 FastQ]
    sample_metadata[Sample metadata]
    reference_fasta[Reference fasta]
    reference_gtf[Reference GTF]
  end
  inputs:::io

  input_r1 & input_r2 & sample_metadata --> prepare_reads --> processed_r1 & processed_r2 & processed_metadata
  prepare_reads[/prepare_reads/]:::comp

  prepare_reads -.-> prepare_reads_qc_data

  reference_fasta & reference_gtf --> prepare_reference --> processed_fasta & processed_gtf & star_index
  prepare_reference[/prepare_reference/]:::comp

  prepare_reference -.-> prepare_reference_qc_data

  processed_r1 & processed_r2 & star_index & processed_fasta & processed_gtf --> align_and_quant --> aligned_reads_bam & quant_matrix
  align_and_quant[/align_and_quant/]:::comp
  align_and_quant -.-> align_and_quant_qc_data

  aligned_reads_bam --> postprocess_bam --> output_aligned_reads_bam
  postprocess_bam[/postprocess_bam/]:::comp
  postprocess_bam -.-> postprocess_bam_qc_data

  quant_matrix & processed_metadata --> postprocess_mtx --> output_quant_matrix
  postprocess_mtx[/postprocess_mtx/]:::comp
  postprocess_mtx -.-> postprocess_mtx_qc_data

  prepare_reads_qc_data & prepare_reference_qc_data & align_and_quant_qc_data & postprocess_bam_qc_data & postprocess_mtx_qc_data -.-> reporting -.-> output_combined_qc_data & output_combined_qc_report
  reporting[/reporting/]:::comp

  processed_metadata & output_quant_matrix & output_combined_qc_data --> conversion --> output_anndata & output_sce
  conversion[/conversion/]:::comp

  subgraph outputs[Outputs]
    output_aligned_reads_bam[Aligned reads]
    output_quant_matrix[Quant matrix]
    output_combined_qc_data[QC Data]
    output_combined_qc_report[QC Report]
    output_anndata[AnnData]
    output_sce[SCE]
  end
  outputs:::io

  subgraph legend[Legend]
    comp[/Component/]:::comp
  end
  legend:::info


  classDef info stroke-dasharray: 4 4
```

## Prepare reads

``` mermaid
flowchart TB

  subgraph inputs[Inputs]
    input_r1[R1 reads]
    input_r2[R2 reads]
    input_strandedness[Strandedness]
  end

  input_r1 --> concat_text_r1[/concat_text/]:::comp
  input_r2 --> concat_text_r2[/concat_text/]:::comp
  concat_text_r1 & concat_text_r2 --> lint_fastq1[/lint_fastq/]:::comp --> trim_reads[/trim_reads/]:::comp --> lint_fastq2[/lint_fastq/]:::comp --> remove_genome_contaminants[/remove_genome_contaminants/]:::comp --> lint_fastq3[/lint_fastq/]:::comp --> remove_rRNA[/remove_rRNA/]:::comp --> lint_fastq4[/lint_fastq/]:::comp --> infer_strandedness[/infer_strandedness/]:::comp --> processed_r1 & processed_r2 & output_strandedness

  input_strandedness --> infer_strandedness
  

  concat_text_r1 & concat_text_r2 --> fastqc_raw[/fastqc_raw/]:::comp --> fastqc_raw_multiqc
  trim_reads --> fastqc_trimmed[/fastqc_trimmed/]:::comp --> fastqc_trimmed_multiqc
  infer_strandedness --> strandedness_multiqc
  fastqc_raw_multiqc & fastqc_trimmed_multiqc & strandedness_multiqc --> prepare_reads_multiqc


  subgraph outputs[Outputs]
    processed_r1[R1 reads]
    processed_r2[R2 reads]
    output_strandedness[Strandedness]
    prepare_reads_multiqc[MultiQC files]
  end

  classDef info stroke-dasharray: 4 4
```
